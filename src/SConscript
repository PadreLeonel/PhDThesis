import os

Import("build_info")
def SymLink(target, source, env):
  os.symlink(os.path.abspath(str(source[0])), os.path.abspath(str(target[0])))

root = Dir('#').abspath

target  = build_info['build_name']
sources = Glob("*cpp") + Glob("*/*cpp")


env = Environment(
#CCFLAGS = " -DNDEBUG -O3 -g -std=c++0x",
	CCFLAGS = "-O3 -g -std=c++0x",
	LINKFLAGS = "-g -lpthread -pthread -L/usr/lib/openmpi -lmpi_cxx -lmpi -ldl -lhwloc")

env['ENV']['TERM'] = os.environ['TERM']
env["CXX"] = "clang++"

obj = env.Program(target = target, source = sources)
install = env.Install(root + "/bin", obj)
env.Command(root + "/bin/mpi", install, SymLink)
env.Command(root + "/bin/sandbox", install, SymLink)
