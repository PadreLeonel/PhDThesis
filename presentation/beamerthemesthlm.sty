% Name		::  sthlm Beamer Theme  HEAVILY based on the hsrmbeamer theme (Benjamin Weiss)
%	Author		::  Mark Hendry Olson (mark@hendryolson.com)
%	Created		::	2013-07-31
%	Updated		::	June 23, 2015 at 23:58
%	Version		::  1.0.0
%	Email		::  mark@hendryolson.com
%	Website		::  http://hendryolson.com
%
% License		::  This file may be distributed and/or modified under the
% GNU Public License.
%
%	Description	::	This presentation is a demonstration of the sthlm beamer
% theme, which is HEAVILY based on the HSRM beamer theme created by Benjamin Weiss
% (benjamin.weiss@student.hs-rm.de), which can be found on GitHub
% <https://github.com/hsrmbeamertheme/hsrmbeamertheme>.
%
%	Contents	::	01. PACKAGE OPTIONS & SETUP
% 02. PACKAGES & TIKZ
% 03. COLOR AND FONT THEMES (BEAMER)
% 04. TITLE PAGE
% 05. TABLE OF CONTENTS
% 06. PROGRESS BAR & HEADLINE
% 07. SECTION PAGES
% 08. ITEMIZE
% 09. FOOTLINE
% 10. CAPTIONS
% 11. FRAME TITLE
% 12. IMAGES
% 13. BLOCKS


% -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
%	01. PACKAGE OPTIONS & SETUP
% -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
\ProvidesPackage{beamerthemesthlm}

\newif\if@useTitleProgressBar
\@useTitleProgressBartrue
\DeclareOptionBeamer{noprogressbar}{\@useTitleProgressBarfalse}

\newif\if@protectFrameTitle
\@protectFrameTitlefalse
\DeclareOptionBeamer{protectframetitle}{\@protectFrameTitletrue}

\newif\if@dosthlmFooter
\@dosthlmFooterfalse
\DeclareOptionBeamer{sthlmFooter}{\@dosthlmFootertrue}

\newif\if@donewPxFont
\@donewPxFontfalse
\DeclareOptionBeamer{newPxFont}{\@donewPxFonttrue}

\newif\if@dosthlmStadFont
\@dosthlmStadFontfalse
\DeclareOptionBeamer{sthlmStadFont}{\@dosthlmStadFonttrue}

\newif\if@dovaligncolumns
\@dovaligncolumnsfalse
\DeclareOptionBeamer{dovaligncolumns}{\@dovaligncolumnstrue}

\newif\if@doSectionPage
\@doSectionPagetrue
\DeclareOptionBeamer{nosectionpage}{\@doSectionPagefalse}

\DeclareOptionBeamer{nooffset}{\setlength{\@sthlm@voffset}{0em}}

\DeclareOptionBeamer*{%
  \PackageWarning{beamerthemesthlm}{Unknown option `\CurrentOption'}%
}

\newlength{\@sthlm@voffset}
\setlength{\@sthlm@voffset}{0.7em}

\setbeamersize{text margin left=1em,text margin right=1em}

\ProcessOptionsBeamer
\mode<presentation>


% -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
%	02. PACKAGES & TIKZ
% -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
\RequirePackage{amsmath}
\RequirePackage{tikz}
\RequirePackage{verbatim}
\RequirePackage{etoolbox}
\RequirePackage{booktabs}
\RequirePackage{ragged2e}
\RequirePackage[yyyymmdd]{datetime}
\RequirePackage{tabularx}
\RequirePackage{wasysym}
\RequirePackage{pgfplots}
\RequirePackage{listings}
\RequirePackage{fp}
\RequirePackage{varwidth}
\RequirePackage{xcolor}
\usepackage{eso-pic}
\usepackage{pdfpages}

\usepackage{multirow}
\newcommand{\specialcell}[2][c]{\begin{tabular}[#1]{@{}c@{}}#2\end{tabular}}

% Use to align an element of tabular table
\newcolumntype{L}[1]{>{\raggedright\let\newline\\\arraybackslash\hspace{0pt}}p{#1}}
\newcolumntype{C}[1]{>{\centering\let\newline\\\arraybackslash\hspace{0pt}}p{#1}}
\newcolumntype{R}[1]{>{\raggedleft\let\newline\\\arraybackslash\hspace{0pt}}p{#1}}


\usepackage{color, colortbl}

\usepackage{subfig,caption}
\usepackage{float}

\usetikzlibrary{matrix}
\usetikzlibrary{arrows,chains,matrix,positioning,scopes}
\usetikzlibrary{positioning}
\usetikzlibrary{shapes,snakes}
\usepgfplotslibrary{groupplots}
\usepgfplotslibrary{fillbetween}
\usetikzlibrary{backgrounds}
\usetikzlibrary{calc}


\pgfplotsset{mystyle/.style={
    cycle list name=exotic,
    x label style={at={(axis description cs:0.5,0)},anchor=north},
    axis y line=left,
    axis x line=bottom,
    enlarge x limits=0.05,
    thick,
    legend columns=-1,
    legend style={
      at={(0.5,1)},
      anchor=south},
    legend style={fill=none,draw=none, /tikz/every even column/.append style={column sep=5pt}},
  }}


\lstnewenvironment{sthlmLatex}
{\lstset{
    language=[LaTeX]TeX,
    basicstyle=\small\ttfamily,
    keywordstyle=\crBlue\bfseries,
    commentstyle=\crRed,
    numbers=none,
    numberstyle=\tiny\ttfamily,
    mathescape=false,
    escapeinside={\%*}{*)},
    stepnumber=1,
    showspaces=false,
    showstringspaces=false,
    showtabs=false,
    breaklines=true,
    frame=tb,
    framerule=0.5pt,
    tabsize=4,
    framexleftmargin=0.5em,
    framexrightmargin=0.5em,
    xleftmargin=0.5em,
    xrightmargin=0.5em
  }}
{}

\lstset{
  basicstyle=\small\ttfamily,
}


% Plot Colors
\definecolor{color1}{RGB}{0,0,51}
\definecolor{color2}{RGB}{0,0,153}
\definecolor{color3}{RGB}{0,0,255}
\definecolor{color4}{RGB}{80,0,255}
\definecolor{color5}{RGB}{159,15,240}
\definecolor{color6}{RGB}{239,66,189}
\definecolor{color7}{RGB}{255,117,138}
\definecolor{color8}{RGB}{255,168,87}
\definecolor{color9}{RGB}{255,219,36}
\definecolor{color10}{RGB}{255,255,96}



% -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
%	GLOBAL MATH
% -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=

\newcommand{\limit}{\displaystyle\lim}
\newcommand{\impart}{\textrm{Im}}
\newcommand{\repart}{\textrm{Re}}
\newcommand{\integer}{\mathbb{Z}}
\newcommand{\degree}{\ensuremath{{}^{\circ}}\xspace}
\newcommand{\rad}{\unit{rad}}
\newcommand{\dd}{\mathrm{d}}
\newcommand{\dx}{\mathrm{d}x}
\newcommand{\dy}{\mathrm{d}y}
\newcommand{\dr}{\mathrm{d}r}
\newcommand{\dtheta}{\mathrm{d}\theta}
\newcommand{\dydx}{\dfrac{\mathrm{d}y}{\mathrm{d}x}}
\newcommand{\dydt}{\dfrac{\mathrm{d}y}{\mathrm{d}t}}
\newcommand{\dxdt}{\dfrac{\mathrm{d}x}{\mathrm{d}t}}
\newcommand{\vect}[1]{\boldsymbol{#1}}
\newcommand{\farg}[1]{{\color{sthlmBlue}{\left[\boldsymbol{#1}\right]}}}
\newcommand{\sname}[1]{\texttt{#1}}
\newcommand{\set}[1]{\left\{#1\right\}}
\newcommand{\inv}{^{-1}}
\newcommand{\cb}{$\Box$}
\newcommand{\suchthat}{\;\ifnum\currentgrouptype=16 \middle\fi|\;}
\newcommand{\ihat}{\hat{\imath}}
\newcommand{\jhat}{\hat{\jmath}}
\newcommand{\khat}{\hat{k}}


% -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
%	LISTINGS PACKAGE
% -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=

\usepackage{listings}
\lstset{ %
  language=[LaTeX]TeX,
  basicstyle=\normalsize\ttfamily,
  keywordstyle=,
  numbers=left,
  numberstyle=\tiny\ttfamily,
  stepnumber=1,
  showspaces=false,
  showstringspaces=false,
  showtabs=false,
  breaklines=true,
  frame=tb,
  framerule=0.5pt,
  tabsize=4,
  framexleftmargin=0.5em,
  framexrightmargin=0.5em,
  xleftmargin=0.5em,
  xrightmargin=0.5em
}

% -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
%	Helper functions
% -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=

\usepackage{ifthen}
\newboolean{presentation_ready}
\setboolean{presentation_ready}{true}

\newboolean{placeholders}
\setboolean{placeholders}{false}



\newcommand{\ready}[2][]{
  \ifthenelse{\boolean{presentation_ready}}
  {#2}
  {#1}
}

\newcommand{\frameready}[1]{
  \ready[
  \ifthenelse{\boolean{placeholders}}{
    \begin{frame}{Placeholder}
    \end{frame}
  }{}
  ]{#1}
}

\newcommand{\editing}[1]{
  \ifthenelse{\boolean{presentation_ready}}{}{#1}
}

\newcommand{\frameediting}[1]{
  \ifthenelse{\boolean{presentation_ready}}{}{#1}
}




% -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
%	03. COLOR AND FONT THEMES (BEAMER)
% -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=

% \usepackage{./template/beamercolorthemesthlm}
% \usepackage{beamerfontthemesthlm}
\usecolortheme[greybg=true]{sthlm}
\usefonttheme{sthlm}


% -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
%	04. TITLE PAGE
% -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
\def\maketitle{\ifbeamer@inframe\titlepage\else\frame[plain]{\titlepage}\fi}

%% Supervisor text
\gdef\@supervisorstext{}

\gdef\supervisor#1#2{%
  \g@addto@macro\@supervisorstext{%
  \item [#1]: #2
  }}

\gdef\@supervisorstext{}

\def\titlepage{\usebeamertemplate{title page}}
\setbeamertemplate{title page}
{
  % \AddToShipoutPictureBG*{
  \begin{tikzpicture}[remember picture,overlay]
    \tikzstyle{every node}=[rectangle,inner sep=0,align=center];

    \node[anchor=south east] at (current page.south east){\includegraphics [height=0.9\paperheight,angle=90]{./figures/gofl/main.pdf}};
    \fill[fill, white!90!black, fill opacity=0.9] (current page.north west) rectangle (current page.south east);

    \node[anchor=south,below = 1.5cm of current page.north] (title) {
      \begin{varwidth}{0.8\paperwidth}
        \ifx\inserttitle\@empty%
        \else%
        {\centering\linespread{1.0}\usebeamerfont{title}\usebeamercolor[fg]{title}\inserttitle\par}%
        \fi%
      \end{varwidth}
    };

    \node(subtitle)[below=0.3cm of title.south,anchor=north,minimum width=0.7\paperwidth] {
      \ifx\insertsubtitle\@empty
      \else\usebeamerfont{subtitle}\usebeamercolor[fg]{subtitle}\insertsubtitle
      \fi
    };

    \node(foo)[below=0.2cm of subtitle.south,anchor=north,minimum width=0.8\paperwidth] {};

    \draw[normal text.fg] let \p1 =(foo.south) in (0, \y1) -- (\textwidth, \y1);
    \node(author)[below=0.5cm of foo.south west,anchor=north west] {
      \ifx\insertauthor\@empty
      \else\usebeamerfont{author}\usebeamercolor[fg]{subtitle}\insertauthor
      \fi%
    };
    \node(supervisors)[below right=1.5cm and 2cm of foo.south,anchor=north] {
      \ifx\insertsupersivors\@empty%
      \else\usebeamerfont{date}\usebeamercolor[fg]{date}
      \begin{varwidth}{0.5\linewidth}
        \begin{description}
          \@supervisorstext
        \end{description}
      \end{varwidth}
      \fi%
    };

    \node (logos)[above=1cm of current page.south,anchor=south] {
      \ifx\insertinstitut\@empty%
      \else\usebeamerfont{institute}\usebeamercolor[fg]{institute}\insertinstitute
      \fi%
    };
    \node (date)[above=0.3cm of current page.south,anchor=south] {
      \usebeamerfont{date}\usebeamercolor[fg]{date}
      \tiny
      \insertdate
    };

  \end{tikzpicture}
}


% -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
%	05. TABLE OF CONTENTS
% -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
\setbeamertemplate{section in toc}[sections numbered]
\setbeamertemplate{subsection in toc}[subsections numbered]


% -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
%	06. PROGRESS BAR & HEADLINE
% -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
\makeatletter
\def\progressbar@sectionprogressbar{}
\def\progressbar@titleprogressbar{}

\newdimen\progressbar@pbht      % progressbar height
\newdimen\progressbar@pbwd      % progressbar width

\newdimen\progressbar@tmpdima    % auxiliary dimension
\newdimen\progressbar@tmpdimb    % auxiliary dimension
\newdimen\progressbar@tmpdimc    % auxiliary dimension

\progressbar@pbwd=20em
\progressbar@pbht=2.5pt

\colorlet{sectiondone}{sthlmBlue!80}
\colorlet{sectioncurrent}{orange!70!white}
\colorlet{sectiontodo}{white}


% the progress bar
\def\progressbar@sectionprogressbar{%
  \usebeamercolor{palette quaternary}%
  %
  \progressbar@tmpdima=0pt%
  \progressbar@tmpdimb=0pt%
  %
  \FPsub\progressbar@sectionpagesminusone{\insertsectionendpage}{\insertsectionstartpage}%
  \FPadd\progressbar@sectionpages{\progressbar@sectionpagesminusone}{1}%
  \FPsub\progressbar@pagesinpresentation{\number\numexpr\insertpresentationendpage}{\insertpresentationstartpage}%
  \FPsub\progressbar@pagesfromstarttosectionstart{\insertsectionstartpage}{\insertpresentationstartpage}%
  \FPsub\progressbar@pagesfromstarttosectionstart{\progressbar@pagesfromstarttosectionstart}{1}%
  %
  \FPifzero\progressbar@pagesinpresentation\relax%
  \else\relax%
  \FPdiv\progressbar@tmpa{\progressbar@pagesfromstarttosectionstart}{\progressbar@pagesinpresentation}%
  \FPdiv\progressbar@tmpb{\progressbar@sectionpages}{\progressbar@pagesinpresentation}%
  %
  \progressbar@tmpdima=\progressbar@tmpa\progressbar@pbwd%
  \progressbar@tmpdimb=\progressbar@tmpb\progressbar@pbwd%
  \fi%
  \fontsize{1em}{1em}\selectfont%
  \begin{tikzpicture}
    \fill[anchor=west, sectiontodo, inner sep=0pt] (0, -1ex) rectangle ++ (\progressbar@pbwd, \progressbar@pbht);

    \fill[anchor=west, sectioncurrent, inner sep=0pt]
    (\progressbar@tmpdima, -1ex) rectangle ++ (\progressbar@tmpdimb, \progressbar@pbht);

    \fill[anchor=west, sectiondone, inner sep=0pt]
    (0, -1ex) rectangle ++ (\progressbar@tmpdima, \progressbar@pbht);
  \end{tikzpicture}%
}

\renewcommand{\insertpresentationendpage}{%
  \ifx\beamer@startpageofappendix\@empty%
  \beamer@endpageofdocument\relax%
  \else%
  \number\numexpr\beamer@startpageofappendix-1\relax%
  \fi%
}


\if@useTitleProgressBar
\def\progressbar@titleprogressbar{%
  {\usebeamercolor{palette quaternary}%
    %
    \FPsub\progressbar@sectionpagesminusone{\insertsectionendpage}{\insertsectionstartpage}%
    \FPadd\progressbar@sectionpages{\progressbar@sectionpagesminusone}{1}%
    \FPsub\progressbar@pagesinpresentation{\number\numexpr\insertpresentationendpage}{\insertpresentationstartpage}%
    \FPsub\progressbar@pagesfromstarttosectionstart{\insertsectionstartpage}{\insertpresentationstartpage}%
    \FPsub\progressbar@pagesfromstarttosectionstart{\progressbar@pagesfromstarttosectionstart}{1}%
    %
    \FPifzero\progressbar@sectionpagesminusone\relax%
    \FPsub\progressbar@tmpa{0}{0}%
    \FPsub\progressbar@tmpb{0}{0}%
    \FPsub\progressbar@tmpc{0}{0}%
    \else\relax%
    \FPsub\progressbar@tmpa{\insertframeendpage}{\insertsectionstartpage}%
    \FPdiv\progressbar@tmpa{\progressbar@tmpa}{\progressbar@sectionpagesminusone}%
    \FPmul\progressbar@tmpa{\progressbar@tmpa}{\progressbar@sectionpages}%
    \FPadd\progressbar@tmpa{\progressbar@tmpa}{\progressbar@pagesfromstarttosectionstart}%
    %
    \FPsub\progressbar@tmpb{\insertframestartpage}{\insertsectionstartpage}%
    \FPsub\progressbar@tmpb{\progressbar@tmpb}{1}%
    \FPdiv\progressbar@tmpb{\progressbar@tmpb}{\progressbar@sectionpagesminusone}%
    \FPmul\progressbar@tmpb{\progressbar@tmpb}{\progressbar@sectionpages}%
    \FPadd\progressbar@tmpb{\progressbar@tmpb}{\progressbar@pagesfromstarttosectionstart}%
    %
    \FPsub\progressbar@tmpc{\insertsectionendpage}{\insertpresentationstartpage}%
    \fi%
    %
    \FPifzero\progressbar@pagesinpresentation\relax%
    \progressbar@tmpdima=0pt%
    \progressbar@tmpdimb=0pt%
    \progressbar@tmpdimc=0pt%
    \else\relax%%
    \FPdiv\progressbar@tmpa{\progressbar@tmpa}{\progressbar@pagesinpresentation}%
    \FPdiv\progressbar@tmpb{\progressbar@tmpb}{\progressbar@pagesinpresentation}%
    \FPdiv\progressbar@tmpc{\progressbar@tmpc}{\progressbar@pagesinpresentation}%
    %
    \progressbar@tmpdima=\progressbar@tmpa\paperwidth%
    \progressbar@tmpdimb=\progressbar@tmpb\paperwidth%
    \progressbar@tmpdimc=\progressbar@tmpc\paperwidth%
    \fi%
    %
      \begin{tikzpicture}[tight background,yscale=-1]%
        \fill[anchor=west, fg, inner sep=0pt]
        (0, 0) rectangle (\paperwidth, 1mm);

        \fill[anchor=west, sectioncurrent, opacity=1, inner sep=0mm]
        (\progressbar@tmpdima, 0) rectangle (\progressbar@tmpdimc, 1mm);
        \fill[anchor=west, sectiondone, inner sep=0mm,opacity=1]
        (0, 0) rectangle (\progressbar@tmpdimb, 1mm);
        \fill[anchor=west, fill=sectioncurrent!80!white!50!sectiondone, inner sep=0mm]
        (\progressbar@tmpdimb, 0) rectangle (\progressbar@tmpdima, 1mm);
      \end{tikzpicture}%
    }%
}
\fi


% -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
%	07. SECTION PAGES
% -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
\if@doSectionPage

\setbeamerfont{title}{family=\sffamily, series=\sffamily, size=\huge}

\newcounter{SectionNumber}
\setcounter{SectionNumber}{0}
\AtBeginSection[] {
\ready{
  \begingroup
  \setbeamercolor{background canvas}{parent=palette primary}
  \begin{frame}[plain]
    \stepcounter{SectionNumber}%
    \begin{tikzpicture}[overlay, remember picture]
      % Debug lines
      % \node[draw,red,very thick,minimum width=\paperwidth-\pgflinewidth,minimum height=				\paperheight-\pgflinewidth] at (current page.north west) [anchor=north west] (mynode) {};
      % \draw[red] (mynode.north west)--(mynode.south east);
      % \draw[red] (mynode.south west)--(mynode.north east);
      \node at (0, -3.5cm + 1.5em * \arabic{SectionNumber}) [inner sep=0,xshift=3.5cm,anchor=base,white] (temp section){};
    \end{tikzpicture}

    \textsf{\tableofcontents[currentsection,sectionstyle=show/shaded]}
  \end{frame}
  \endgroup
}
}
\else
\fi

\tikzset{
  Secbase/.style={
    % draw,
    outer sep=0pt,
    inner sep=2pt,
    minimum height=1.5em,
    opacity=#1,
    white,
  },
  Secnal/.style={
    Secbase=#1,
    align=left,
    anchor=north east,
    below left=0mm and 0em of temp section.south east,
    font=\footnotesize,
  },
  Subsecnal/.style={
    Secbase=#1,
    left,
    anchor=north west,
    below right=1mm and 0em of true subsection.south west,
  },
}

\defbeamertemplate*{section in toc}{fabulous}{
  \begin{tikzpicture}[remember picture, overlay]
    \node[Secnal=0.6,sectioncurrent] (temp section){\usebeamerfont{block title}\small\inserttocsection};
    \node[Secbase=1, below right=0em and 1em of temp section.south east, anchor=south west,minimum height=1.5em] (true section)
    {\parbox[t][1em]{0.6\linewidth}{\usebeamerfont{section title}\insertsectionhead}};
    \node[Secbase=1, anchor=north west, below right=0cm and 0mm of true section.south west, minimum height=0em](true subsection){\progressbar@sectionprogressbar};
    \coordinate[anchor=north west, below right=0cm and 1em of true subsection.south west](true subsection);
    \draw[opacity=0.4, sectioncurrent](temp section.south west) -- (temp section.south east);
  \end{tikzpicture}%
}

\defbeamertemplate*{section in toc shaded}{fabulous}[1][1]{%
  \ifthenelse{\arabic{SectionNumber} > \inserttocsectionnumber}{%
      \tikzstyle{sectioncolor}=[sectiondone]%
    }{%
      \tikzstyle{sectioncolor}=[sectiontodo]%
    }%
    %
    \begin{tikzpicture}[remember picture, overlay]
      \pgfmathparse{0.5 * (6 - abs(\arabic{SectionNumber}-\inserttocsectionnumber)) / 5}
      \edef\opa{\pgfmathresult}
      \node[Secnal=1,opacity=\opa,sectioncolor](temp section){\inserttocsection};
    \end{tikzpicture}%
}

\defbeamertemplate*{subsection in toc}{fabulous}{
  \begin{tikzpicture}[remember picture, overlay]
    \node (true subsection)[Subsecnal=1] {\usebeamerfont{block title}\textbf{--}\hspace{0.5em}\inserttocsubsection};
  \end{tikzpicture}
}

\defbeamertemplate*{subsection in toc shaded}{fabulous}[1][0]{
    \begin{tikzpicture}[remember picture, overlay]
    \end{tikzpicture}
}


% -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
%	08. ITEMIZE
% -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
\setbeamertemplate{itemize item}{$\star$}
\setbeamertemplate{itemize subitem}{\small$\star$}
\setbeamertemplate{itemize subsubitem}{\tiny$\star$}
\setlength{\parskip}{0.5em}


% -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
%	09. FOOTLINE
% -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
\usenavigationsymbolstemplate{}

\if@dosthlmFooter
\setbeamertemplate{footline}{
  \hbox{
    \begin{beamercolorbox}[wd=0.25\textwidth,dp=1.5ex,leftskip=0.3cm,rightskip=0.3cm]{structure}
      \includegraphics[width=0.25\textwidth]{./figures/feup}
    \end{beamercolorbox}
    \begin{beamercolorbox}[wd=0.75\textwidth, dp=1.5ex,leftskip=0.3cm,rightskip=0.3cm plus1fil]{structure}
      \usebeamerfont{page number in head/foot}
      % \hfill\insertdate \newline

      \vspace*{1em}

      \hfill \insertframenumber/\inserttotalframenumber
      \vspace*{1em}
    \end{beamercolorbox}
  }}
\else%
\usenavigationsymbolstemplate{}
\fi%


% -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
%	10. CAPTIONS
% -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
\setbeamertemplate{caption label separator}{: }


% -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
%	11. FRAME TITLE
% -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
\setbeamertemplate{frametitle}{%
  \nointerlineskip%
  \begin{beamercolorbox}[wd=\paperwidth,ht=1mm,dp=0pt]{frametitle}%
    \ready{\progressbar@titleprogressbar}%
  \end{beamercolorbox}%
    \vspace{-1.5mm}
  \begin{beamercolorbox}[wd=\paperwidth,leftskip=0.3cm,rightskip=0.3cm,ht=6mm,dp=0.5em]{frametitle}%
    \setlength{\tabcolsep}{0cm}%
    \begin{tabular}{L{8cm}C{4cm}}%
      \editing{\cellcolor{red!20!black}}%
      \if@protectFrameTitle%
      \usebeamerfont{frametitle}{\protect\insertframetitle}%
      \else%
      \usebeamerfont{frametitle}{\insertframetitle}%
      \fi%
      &%
        \editing{\cellcolor{green!20!black}}%
        \usebeamerfont{framesubtitle}{\usebeamercolor[fg]{subtitle}\insertframesubtitle}%
    \end{tabular}
  \end{beamercolorbox}%
  \vspace{-2.5mm}
}


% -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
%	12. IMAGES
% -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
\newbox\mytempbox
\newdimen\mytempdimen

\newcommand\includegraphicscopyright[3][]{%
  \leavevmode\vbox{\vskip3pt\raggedright\setbox\mytempbox=\hbox{\includegraphics[#1]{#2}}%
    \mytempdimen=\wd\mytempbox\box\mytempbox\par\vskip1pt%
    \usebeamerfont{copyright text}{\usebeamercolor[fg]{copyright text}{\vbox{\hsize=\mytempdimen#3}}}\vskip3pt%
  }}


% -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
%	13. BLOCKS
% -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
\setbeamertemplate{block begin}
{
  \setbeamercolor{item}{parent=block body}
  \leavevmode%
  \begin{beamercolorbox}[sep=.5ex,ht=4.25ex,dp=0pt,leftskip=0.5ex,rightskip=0.5ex]{block title}%
    \vbox to 3.25ex{\vfil\hbox{\usebeamerfont*{block title}\insertblocktitle{\hskip0pt plus1filll}}\vfil}%
  \end{beamercolorbox}%
  \vskip0pt%
  {\parskip0pt\par}%
  {\nointerlineskip\vskip-0.5pt}%
  \usebeamerfont{block body}%
  \begin{beamercolorbox}[sep=.5ex,dp=0ex,leftskip=0.5ex,rightskip=0.5ex,vmode]{block body}%
  }
  \setbeamertemplate{block end}
  {\end{beamercolorbox}\vskip\smallskipamount}

\setbeamertemplate{block alerted begin}
{
  \setbeamercolor{item}{parent=block body alerted}
  \leavevmode%
  \begin{beamercolorbox}[sep=.5ex,ht=4.25ex,dp=0pt,leftskip=0.5ex,rightskip=0.5ex]{block title alerted}%
    \vbox to 3.25ex{\vfil\hbox{\usebeamerfont*{block title alerted}\insertblocktitle{\hskip0pt plus1filll}}\vfil}%
  \end{beamercolorbox}%
  \vskip0pt%
  {\parskip0pt\par}%
  {\nointerlineskip\vskip-0.5pt}%
  \usebeamerfont{block body alerted}%
  \begin{beamercolorbox}[sep=.5ex,dp=0ex,leftskip=0.5ex,rightskip=0.5ex,vmode]{block body alerted}%
  }
  \setbeamertemplate{block alerted end}
  {\end{beamercolorbox}\vskip\smallskipamount}

\setbeamertemplate{block example begin}
{
  \leavevmode%
  \begin{beamercolorbox}[sep=.5ex,ht=4.25ex,dp=0pt,leftskip=0.5ex,rightskip=0.5ex]{block title example}%
    \vbox to 3.25ex{\vfil\hbox{\usebeamerfont*{block title example}\insertblocktitle{\hskip0pt plus1filll}}\vfil}%
  \end{beamercolorbox}%
  \vskip0pt%
  {\parskip0pt\par}%
  {\nointerlineskip\vskip-0.5pt}%
  \usebeamerfont{block body example}%
  \begin{beamercolorbox}[sep=.5ex,dp=0ex,leftskip=0.5ex,rightskip=0.5ex,vmode]{block body example}%
  }
  \setbeamertemplate{block example end}
  {\end{beamercolorbox}\vskip\smallskipamount}

\mode
<all>

\let\otp\titlepage
\renewcommand{\titlepage}{\otp\addtocounter{framenumber}{-1}}
\newcommand{\mreducelistspacing}{\vspace{-\topsep}}

\linespread{1.15}
\setlength{\fboxsep}{0pt}%

\newcommand{\monocolumn}[2][1]{%
  \pgfmathparse{0.955 * #1}%
  \edef\cola{\pgfmathresult}%
  \begin{columns}%
    \column[T]{\cola\columnwidth}%
    \centering%
    #2%
  \end{columns}%
}

% Usage: \bicolumn[first%]{content a}{content b}
\newcommand{\bicolumn}[3][0.5]{%
  \pgfmathparse{0.9 * #1}%
  \edef\cola{\pgfmathresult}%
  \pgfmathparse{0.9 * (1 - #1)}%
  \edef\colb{\pgfmathresult}
  \begin{columns}%
    \column[T]{\cola\columnwidth}%
    \centering%
      #2%
    \column[T]{{\colb\columnwidth}}%
    \centering%
      #3%
  \end{columns}%
}

% Usage: \tricolumn[first%]{second%}{content a}{content b}{content c}
\newcommand{\tricolumn}[5]{%
  \edef\totwidth{0.85}%
  \pgfmathparse{\totwidth * #1}%
  \edef\cola{\pgfmathresult}%
  \pgfmathparse{\totwidth * (1 - #1) * #2}%
  \edef\colb{\pgfmathresult}%
  \pgfmathparse{\totwidth * (1 - #1) * (1 - #2}%
  \edef\colc{\pgfmathresult}
  \begin{columns}%
    \column[T]{\cola\columnwidth}%
    \centering%
      #3%
    \column[T]{{\colb\columnwidth}}%
    \centering%
      #4%
      \column[T]{{\colc\columnwidth}}%
      \centering%
      #5%
    \end{columns}%
}
\newenvironment{blockH}[3][c]{%
  \begin{block}{#2}%
    \begin{minipage}[#1][#3]{\columnwidth}%
    }{%
    \end{minipage}%
  \end{block}%
}

\newcommand{\enablegrid}{
  \setbeamertemplate{background}{\tikz[overlay, remember picture]{%, help lines]{
      \tikzstyle{every node}=[opacity=0.1];
      \tikzstyle{line}=[ultra thin,draw,opacity=0.1];

      \foreach \x in {0,10,...,100} {
        \pgfmathparse{(\x-50)*0.0098}
        \edef\newx{\pgfmathresult}
        \path (current page.south) +(\newx\columnwidth,1.5em) node[anchor=west] {\Tiny$\x\%$};
        \draw[line] (current page.south) ++(\newx\columnwidth,0) -- +(0,9.6);
      }
      \foreach \y in {0,...,20} {
        \pgfmathparse{19-\y}
        \edef\newy{\pgfmathresult}
        \path (current page.south west) +(12.3, \newy em) node[anchor=south west,inner sep=0pt] {\Tiny$\y{}em$};
        \draw[line] (current page.south west) ++(0, \newy em) -- +(12.8,0);
      }
    }
  }
}
